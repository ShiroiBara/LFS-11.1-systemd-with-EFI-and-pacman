pkgname=systemd
pkgver=250
pkgrel=1
pkgdesc="System and service manager"
arch=('x86_64')
url="https://www.github.com/systemd/systemd"
source=($pkgname-$pkgver.tar.gz
systemd-man-pages-250.tar.xz)
md5sums=('SKIP'
'SKIP')
license=('GPL2' 'LGPL2.1')
install=systemd.install

prepare() {

    cd "$srcdir/$pkgname-$pkgver"
    patch -Np1 -i ../../systemd-250-upstream_fixes-1.patch
    sed -i -e 's/GROUP="render"/GROUP="video"/' \
           -e 's/GROUP="sgx", //' rules.d/50-udev-default.rules.in

}

build() {

    cd "$srcdir/$pkgname-$pkgver"

    mkdir -p build
    cd       build

    meson --prefix=/usr     \
    --sysconfdir=/etc       \
    --localstatedir=/var    \
    --buildtype=release     \
    -Dblkid=true            \
    -Ddefault-dnssec=no     \
    -Dfirstboot=false       \
    -Dinstall-tests=false   \
    -Dldconfig=false        \
    -Dsysusers=false        \
    -Db_lto=false           \
    -Drpmmacrosdir=no       \
    -Dhomed=false           \
    -Duserdb=false          \
    -Dman=false             \
    -Dmode=release          \
    -Ddocdir=/usr/share/doc/systemd-250 \
    -Dgnu-efi=true          \
    -Dsbat-distro='lfs'     \
    -Dsbat-distro-summary="Linux From Scratch"  \
    -Dsbat-distro-url="https://linuxfromscratch.org" \
    ..

    ninja -j6

}

check() {

    cd "$srcdir/$pkgname-$pkgver" 
}

package() {

    cd $srcdir/$pkgname-$pkgver/build
    DESTDIR=$pkgdir ninja install
    install -vdm755 $pkgdir/usr/share/man
    tar -xf ../../../systemd-man-pages-250.tar.xz -C $pkgdir/usr/share/man
    rm -rf $pkgdir/usr/lib/pam.d

}
